<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Spatial Weights | rgeoda version 0.0.3</title>
  <meta name="description" content="This is a tutorial book to introduce the rgeoda v0.0.3 library. This book includes all the functions that are provided in version 0.0.3. Since rgeoda is under active development, this book will be updated frequently. Please watch this github repository to get any notifications." />
  <meta name="generator" content="bookdown 0.14 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Spatial Weights | rgeoda version 0.0.3" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a tutorial book to introduce the rgeoda v0.0.3 library. This book includes all the functions that are provided in version 0.0.3. Since rgeoda is under active development, this book will be updated frequently. Please watch this github repository to get any notifications." />
  <meta name="github-repo" content="rgeoda/book_intro" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Spatial Weights | rgeoda version 0.0.3" />
  
  <meta name="twitter:description" content="This is a tutorial book to introduce the rgeoda v0.0.3 library. This book includes all the functions that are provided in version 0.0.3. Since rgeoda is under active development, this book will be updated frequently. Please watch this github repository to get any notifications." />
  

<meta name="author" content="Xun Li" />


<meta name="date" content="2019-10-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="load-spatial-data.html"/>
<link rel="next" href="spatial-autocorrelation.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="toc.css" type="text/css" />
<link rel="stylesheet" href="fontawesome.min.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">rgeoda v0.0.3</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#live-tutorials"><i class="fa fa-check"></i><b>1.1</b> Live Tutorials</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#open-resources"><i class="fa fa-check"></i><b>1.2</b> Open Resources</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Installation</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#dependencies"><i class="fa fa-check"></i><b>2.1</b> Dependencies</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#mac"><i class="fa fa-check"></i><b>2.2</b> Mac</a></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#windows"><i class="fa fa-check"></i><b>2.3</b> Windows</a></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#linux"><i class="fa fa-check"></i><b>2.4</b> Linux</a></li>
<li class="chapter" data-level="2.5" data-path="intro.html"><a href="intro.html#load-rgeoda-library-in-r"><i class="fa fa-check"></i><b>2.5</b> Load rgeoda library in R</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="load-spatial-data.html"><a href="load-spatial-data.html"><i class="fa fa-check"></i><b>3</b> Load Spatial Data</a><ul>
<li class="chapter" data-level="3.1" data-path="load-spatial-data.html"><a href="load-spatial-data.html#attributes-of-geoda-object"><i class="fa fa-check"></i><b>3.1</b> Attributes of <code>geoda</code> object</a></li>
<li class="chapter" data-level="3.2" data-path="load-spatial-data.html"><a href="load-spatial-data.html#access-table-data"><i class="fa fa-check"></i><b>3.2</b> Access Table Data</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="spatial-weights.html"><a href="spatial-weights.html"><i class="fa fa-check"></i><b>4</b> Spatial Weights</a><ul>
<li class="chapter" data-level="4.1" data-path="spatial-weights.html"><a href="spatial-weights.html#queen-contiguity-weights"><i class="fa fa-check"></i><b>4.1</b> Queen Contiguity Weights</a></li>
<li class="chapter" data-level="4.2" data-path="spatial-weights.html"><a href="spatial-weights.html#attributes-of-weight-object"><i class="fa fa-check"></i><b>4.2</b> Attributes of <code>Weight</code> object</a></li>
<li class="chapter" data-level="4.3" data-path="spatial-weights.html"><a href="spatial-weights.html#rook-contiguity-weights"><i class="fa fa-check"></i><b>4.3</b> Rook Contiguity Weights</a></li>
<li class="chapter" data-level="4.4" data-path="spatial-weights.html"><a href="spatial-weights.html#distance-based-weights"><i class="fa fa-check"></i><b>4.4</b> Distance Based Weights</a></li>
<li class="chapter" data-level="4.5" data-path="spatial-weights.html"><a href="spatial-weights.html#k-nearest-neighbor-weights"><i class="fa fa-check"></i><b>4.5</b> K-Nearest Neighbor Weights</a></li>
<li class="chapter" data-level="4.6" data-path="spatial-weights.html"><a href="spatial-weights.html#kernel-weights"><i class="fa fa-check"></i><b>4.6</b> Kernel Weights</a><ul>
<li class="chapter" data-level="4.6.1" data-path="spatial-weights.html"><a href="spatial-weights.html#kernel-weights-with-fixed-bandwidth"><i class="fa fa-check"></i><b>4.6.1</b> Kernel Weights with fixed bandwidth</a></li>
<li class="chapter" data-level="4.6.2" data-path="spatial-weights.html"><a href="spatial-weights.html#kernel-weights-with-adaptive-bandwidth"><i class="fa fa-check"></i><b>4.6.2</b> Kernel Weights with adaptive bandwidth</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html"><i class="fa fa-check"></i><b>5</b> Spatial Autocorrelation</a><ul>
<li class="chapter" data-level="5.1" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#local-moran"><i class="fa fa-check"></i><b>5.1</b> Local Moran</a></li>
<li class="chapter" data-level="5.2" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#lisa-object"><i class="fa fa-check"></i><b>5.2</b> LISA object</a></li>
<li class="chapter" data-level="5.3" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#local-geary"><i class="fa fa-check"></i><b>5.3</b> Local Geary</a></li>
<li class="chapter" data-level="5.4" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#local-getis-ord-statistics"><i class="fa fa-check"></i><b>5.4</b> Local Getis-Ord Statistics</a></li>
<li class="chapter" data-level="5.5" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#local-join-count"><i class="fa fa-check"></i><b>5.5</b> Local Join Count</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="spatial-clustering.html"><a href="spatial-clustering.html"><i class="fa fa-check"></i><b>6</b> Spatial Clustering</a><ul>
<li class="chapter" data-level="6.1" data-path="spatial-clustering.html"><a href="spatial-clustering.html#skater"><i class="fa fa-check"></i><b>6.1</b> SKATER</a></li>
<li class="chapter" data-level="6.2" data-path="spatial-clustering.html"><a href="spatial-clustering.html#redcap"><i class="fa fa-check"></i><b>6.2</b> REDCAP</a></li>
<li class="chapter" data-level="6.3" data-path="spatial-clustering.html"><a href="spatial-clustering.html#max-p"><i class="fa fa-check"></i><b>6.3</b> Max-p</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="esda-with-rgeoda-and-sp.html"><a href="esda-with-rgeoda-and-sp.html"><i class="fa fa-check"></i><b>7</b> ESDA with rgeoda and sp</a><ul>
<li class="chapter" data-level="7.1" data-path="esda-with-rgeoda-and-sp.html"><a href="esda-with-rgeoda-and-sp.html#start-from-sp-package"><i class="fa fa-check"></i><b>7.1</b> Start from sp package</a></li>
<li class="chapter" data-level="7.2" data-path="esda-with-rgeoda-and-sp.html"><a href="esda-with-rgeoda-and-sp.html#create-geoda-object-from-sp"><i class="fa fa-check"></i><b>7.2</b> Create geoda object from sp</a></li>
<li class="chapter" data-level="7.3" data-path="esda-with-rgeoda-and-sp.html"><a href="esda-with-rgeoda-and-sp.html#esda-with-rgeoda-and-sp-1"><i class="fa fa-check"></i><b>7.3</b> ESDA with rgeoda and sp</a><ul>
<li class="chapter" data-level="7.3.1" data-path="esda-with-rgeoda-and-sp.html"><a href="esda-with-rgeoda-and-sp.html#local-moran-map"><i class="fa fa-check"></i><b>7.3.1</b> Local Moran Map</a></li>
<li class="chapter" data-level="7.3.2" data-path="esda-with-rgeoda-and-sp.html"><a href="esda-with-rgeoda-and-sp.html#local-geary-map"><i class="fa fa-check"></i><b>7.3.2</b> Local Geary Map</a></li>
<li class="chapter" data-level="7.3.3" data-path="esda-with-rgeoda-and-sp.html"><a href="esda-with-rgeoda-and-sp.html#local-g-map"><i class="fa fa-check"></i><b>7.3.3</b> Local G Map</a></li>
<li class="chapter" data-level="7.3.4" data-path="esda-with-rgeoda-and-sp.html"><a href="esda-with-rgeoda-and-sp.html#skater-map"><i class="fa fa-check"></i><b>7.3.4</b> SKATER Map</a></li>
<li class="chapter" data-level="7.3.5" data-path="esda-with-rgeoda-and-sp.html"><a href="esda-with-rgeoda-and-sp.html#max-p-clustering-map"><i class="fa fa-check"></i><b>7.3.5</b> Max-p Clustering Map</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="esda-with-rgeoda-and-sf.html"><a href="esda-with-rgeoda-and-sf.html"><i class="fa fa-check"></i><b>8</b> ESDA with rgeoda and sf</a><ul>
<li class="chapter" data-level="8.1" data-path="esda-with-rgeoda-and-sf.html"><a href="esda-with-rgeoda-and-sf.html#start-from-sf-package"><i class="fa fa-check"></i><b>8.1</b> Start from sf package</a></li>
<li class="chapter" data-level="8.2" data-path="esda-with-rgeoda-and-sf.html"><a href="esda-with-rgeoda-and-sf.html#create-geoda-object-from-sf"><i class="fa fa-check"></i><b>8.2</b> Create geoda object from sf</a></li>
<li class="chapter" data-level="8.3" data-path="esda-with-rgeoda-and-sf.html"><a href="esda-with-rgeoda-and-sf.html#esda-with-rgeoda-and-sf-1"><i class="fa fa-check"></i><b>8.3</b> ESDA with rgeoda and sf</a><ul>
<li class="chapter" data-level="8.3.1" data-path="esda-with-rgeoda-and-sf.html"><a href="esda-with-rgeoda-and-sf.html#local-moran-map-1"><i class="fa fa-check"></i><b>8.3.1</b> Local Moran Map</a></li>
<li class="chapter" data-level="8.3.2" data-path="esda-with-rgeoda-and-sf.html"><a href="esda-with-rgeoda-and-sf.html#local-geary-map-1"><i class="fa fa-check"></i><b>8.3.2</b> Local Geary Map</a></li>
<li class="chapter" data-level="8.3.3" data-path="esda-with-rgeoda-and-sf.html"><a href="esda-with-rgeoda-and-sf.html#local-g-map-1"><i class="fa fa-check"></i><b>8.3.3</b> Local G Map</a></li>
<li class="chapter" data-level="8.3.4" data-path="esda-with-rgeoda-and-sf.html"><a href="esda-with-rgeoda-and-sf.html#skater-map-1"><i class="fa fa-check"></i><b>8.3.4</b> SKATER Map</a></li>
<li class="chapter" data-level="8.3.5" data-path="esda-with-rgeoda-and-sf.html"><a href="esda-with-rgeoda-and-sf.html#max-p-clustering-map-1"><i class="fa fa-check"></i><b>8.3.5</b> Max-p Clustering Map</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rgeoda/rgeoda-book" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">rgeoda version 0.0.3</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="spatial-weights" class="section level1">
<h1><span class="header-section-number">4</span> Spatial Weights</h1>
<p>Spatial weights are central components in spatial data analysis. The spatial weights represents the possible spatial interaction between observations in space. Like GeoDa desktop software, <code>rgeoda</code> provides a rich variety of methods to create several different types of spatial weights:</p>
<ul>
<li>Contiguity Based Weights: <code>queen_weights()</code>, <code>rook_weights()</code></li>
<li>Distance Based Weights: <code>distance_weights()</code></li>
<li>K-Nearest Neighbor Weights: <code>knn_weights()</code></li>
<li>Kernel Weights: <code>distance_weights()</code> and <code>knn_weights()</code> with kernel parameters</li>
</ul>
<div id="queen-contiguity-weights" class="section level2">
<h2><span class="header-section-number">4.1</span> Queen Contiguity Weights</h2>
<p>To create a Queen contiguity weights, we can call pygeoda’s function</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw">queen_weights</span>(gda, <span class="dt">order=</span><span class="dv">1</span>, <span class="dt">include_lower_order =</span> False, <span class="dt">precision_threshold =</span> <span class="dv">0</span>)</a></code></pre></div>
<p>by passing the GeoDa object <code>guerry</code> we just created:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">queen_w &lt;-<span class="st"> </span><span class="kw">queen_weights</span>(guerry)</a>
<a class="sourceLine" id="cb23-2" data-line-number="2">queen_w</a></code></pre></div>
<pre><code>## Reference class object of class &quot;Weight&quot;
## Field &quot;gda_w&quot;:
## An object of class &quot;_p_GeoDaWeight&quot;
## Slot &quot;ref&quot;:
## &lt;pointer: 0x7fbe695b2520&gt;
## 
## Field &quot;is_symmetric&quot;:
## [1] TRUE
## Field &quot;sparsity&quot;:
## [1] 0
## Field &quot;density&quot;:
## [1] 5.813149
## Field &quot;min_neighbors&quot;:
## [1] 2
## Field &quot;max_neighbors&quot;:
## [1] 8
## Field &quot;num_obs&quot;:
## [1] 85
## Field &quot;mean_neighbors&quot;:
## [1] 4.941176
## Field &quot;median_neighbors&quot;:
## [1] 5</code></pre>
<p>The function <code>queen_weights()</code> returns an instance of
<code>Weight</code> object. One can access the meta data of the spatial
weights by accessing the attributes of <code>GeoDaWeight</code> object:</p>
</div>
<div id="attributes-of-weight-object" class="section level2">
<h2><span class="header-section-number">4.2</span> Attributes of <code>Weight</code> object</h2>
<ul>
<li>weight_type</li>
<li>is_symmetric</li>
<li>sparsity</li>
<li>density</li>
<li>min_nbrs</li>
<li>max_nbrs</li>
<li>mean_nbrs</li>
<li>median_nbrs</li>
<li>bool HasIsolates()</li>
<li>[] GetNeighbors(idx)</li>
<li>double SpatialLag(idx, [data])</li>
<li>SaveToFile()</li>
</ul>
<p>We can also access the details of the weights: e.g. list the neighbors of a specified observation, which is very helpful in exploratory spatial data analysis (which is focused in next tutorial):</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">nbrs &lt;-<span class="st"> </span>queen_w<span class="op">$</span><span class="kw">GetNeighbors</span>(<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Neighbors of 0-st observation are:&quot;</span>, nbrs)</a></code></pre></div>
<pre><code>## 
## Neighbors of 0-st observation are: 35 36 66 68</code></pre>
<p>We can also compute the spatial lag of a specified observation by passing the values of the selected variable:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">lag0 &lt;-<span class="st"> </span>queen_w<span class="op">$</span><span class="kw">SpatialLag</span>(<span class="dv">0</span>, crm_prp)</a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Spatial lag of 0-st observation is:&quot;</span>, lag0)</a></code></pre></div>
<pre><code>## 
## Spatial lag of 0-st observation is: 7899.25</code></pre>
</div>
<div id="rook-contiguity-weights" class="section level2">
<h2><span class="header-section-number">4.3</span> Rook Contiguity Weights</h2>
<p>To create a Rook contiguity weights, we can call pygeoda’s function</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw">rook_weights</span>(gda, <span class="dt">order=</span><span class="dv">1</span>,<span class="dt">include_lower_order=</span>False, <span class="dt">precision_threshold =</span> <span class="dv">0</span>)</a></code></pre></div>
<p>by passing the GeoDa object <code>guerry</code> we just created:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">rook_w &lt;-<span class="st"> </span><span class="kw">rook_weights</span>(guerry)</a>
<a class="sourceLine" id="cb30-2" data-line-number="2">rook_w</a></code></pre></div>
<pre><code>## Reference class object of class &quot;Weight&quot;
## Field &quot;gda_w&quot;:
## An object of class &quot;_p_GeoDaWeight&quot;
## Slot &quot;ref&quot;:
## &lt;pointer: 0x7fbe72814960&gt;
## 
## Field &quot;is_symmetric&quot;:
## [1] TRUE
## Field &quot;sparsity&quot;:
## [1] 0
## Field &quot;density&quot;:
## [1] 5.813149
## Field &quot;min_neighbors&quot;:
## [1] 2
## Field &quot;max_neighbors&quot;:
## [1] 8
## Field &quot;num_obs&quot;:
## [1] 85
## Field &quot;mean_neighbors&quot;:
## [1] 4.941176
## Field &quot;median_neighbors&quot;:
## [1] 5</code></pre>
<p>The weights we created are in memory, which makes it straight forward for spatial data analysis and also are good for programming your application. To save the weights to a file, we need to call GeoDaWeight’s function</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw">SaveToFile</span>(ofname, layer_name, id_name, id_vec)</a></code></pre></div>
<p>The <code>layer_name</code> is the layer name of loaded dataset. For a ESRI shapefile, the layer name is the file name without the suffix (e.g. Guerry).</p>
<p>The <code>id_name</code> is a key (column name), which means the associated column contains unique values, that makes sure that the weights are connected to the correct observations in the data table.</p>
<p>The <code>id_vec</code> is the actual column data of <code>id_name</code>, it could be a tuple of integer or string values.</p>
<p>For example, in Guerry dataset, the column “CODE_DE” can be used as a key to save a weights file:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">rook_w<span class="op">$</span><span class="kw">SaveToFile</span>(<span class="st">&#39;/Users/xun/Downloads/Guerry_r.gal&#39;</span>, <span class="st">&#39;Guerry&#39;</span>, <span class="st">&#39;CODE_DE&#39;</span>, guerry<span class="op">$</span><span class="kw">GetIntegerCol</span>(<span class="st">&#39;CODE_DE&#39;</span>))</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Then, we should find the file “Guerry_r.gal” in the output directory.</p>
</div>
<div id="distance-based-weights" class="section level2">
<h2><span class="header-section-number">4.4</span> Distance Based Weights</h2>
<p>To create a Distance based weights, we can call rgeoda’s function</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="kw">gda_distance_weights</span>(gda, dist_thres, <span class="dt">power=</span><span class="fl">1.0</span>,  <span class="dt">is_inverse=</span>False, <span class="dt">is_arc=</span>False, <span class="dt">is_mile=</span>True)</a></code></pre></div>
<p>by passing the GeoDa object <code>guerry</code> we just created and the value of distance threshold. Like GeoDa, rgeoda provides a function to help you find a optimized distance threshold that guarantees that every observation has at least one neighbor:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="kw">gda_min_distthreshold</span>(GeoDa gda, bool <span class="dt">is_arc =</span> False, bool <span class="dt">is_mile =</span> True)</a></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1">dist_thres &lt;-<span class="st"> </span><span class="kw">min_distthreshold</span>(guerry)</a>
<a class="sourceLine" id="cb37-2" data-line-number="2">dist_w &lt;-<span class="st"> </span><span class="kw">distance_weights</span>(guerry, dist_thres)</a>
<a class="sourceLine" id="cb37-3" data-line-number="3">dist_w</a></code></pre></div>
<pre><code>## Reference class object of class &quot;Weight&quot;
## Field &quot;gda_w&quot;:
## An object of class &quot;_p_GeoDaWeight&quot;
## Slot &quot;ref&quot;:
## &lt;pointer: 0x7fbe6c07e3e0&gt;
## 
## Field &quot;is_symmetric&quot;:
## [1] FALSE
## Field &quot;sparsity&quot;:
## [1] 0
## Field &quot;density&quot;:
## [1] 4.346021
## Field &quot;min_neighbors&quot;:
## [1] 1
## Field &quot;max_neighbors&quot;:
## [1] 7
## Field &quot;num_obs&quot;:
## [1] 85
## Field &quot;mean_neighbors&quot;:
## [1] 3.694118
## Field &quot;median_neighbors&quot;:
## [1] 4</code></pre>
</div>
<div id="k-nearest-neighbor-weights" class="section level2">
<h2><span class="header-section-number">4.5</span> K-Nearest Neighbor Weights</h2>
<p>A special case of distance based weights is K-Nearest neighbor weights, in which every obersvation will have exactly k neighbors. To create a KNN weights, we can call pygeoda’s function:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="kw">gda_knn_weights</span>(gda, k, <span class="dt">power =</span> <span class="fl">1.0</span>,<span class="dt">is_inverse =</span> False, <span class="dt">is_arc =</span> False, <span class="dt">is_mile =</span> True)</a></code></pre></div>
<p>For example, to create a 6-nearest neighbor weights using Guerry dataset:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">knn6_w &lt;-<span class="st"> </span><span class="kw">knn_weights</span>(guerry, <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb40-2" data-line-number="2">knn6_w</a></code></pre></div>
<pre><code>## Reference class object of class &quot;Weight&quot;
## Field &quot;gda_w&quot;:
## An object of class &quot;_p_GeoDaWeight&quot;
## Slot &quot;ref&quot;:
## &lt;pointer: 0x7fbe69529dc0&gt;
## 
## Field &quot;is_symmetric&quot;:
## [1] FALSE
## Field &quot;sparsity&quot;:
## [1] 0
## Field &quot;density&quot;:
## [1] 7.058824
## Field &quot;min_neighbors&quot;:
## [1] 6
## Field &quot;max_neighbors&quot;:
## [1] 6
## Field &quot;num_obs&quot;:
## [1] 85
## Field &quot;mean_neighbors&quot;:
## [1] 6
## Field &quot;median_neighbors&quot;:
## [1] 6</code></pre>
</div>
<div id="kernel-weights" class="section level2">
<h2><span class="header-section-number">4.6</span> Kernel Weights</h2>
<p>Kernel weights apply kernel function to determine the distance decay in the derived continuous weights kernel. The kernel weights are defined as a function K(z) of the ratio between the distance dij from i to j, and the bandwidth hi, with z=dij/hi.</p>
<p>The kernl functions include</p>
<ul>
<li>triangular</li>
<li>uniform</li>
<li>quadratic</li>
<li>epanechnikov</li>
<li>quartic</li>
<li>gaussian</li>
</ul>
<p>Two functions are provided in rgeoda to create kernel weights:</p>
<div id="kernel-weights-with-fixed-bandwidth" class="section level3">
<h3><span class="header-section-number">4.6.1</span> Kernel Weights with fixed bandwidth</h3>
<p>To create a kernel weights with fixed bandwith:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1">bandwidth &lt;-<span class="st"> </span><span class="kw">min_distthreshold</span>(guerry)</a>
<a class="sourceLine" id="cb42-2" data-line-number="2">kernel_w &lt;-<span class="st"> </span><span class="kw">kernel_weights</span>(guerry, bandwidth, <span class="st">&quot;uniform&quot;</span>)</a>
<a class="sourceLine" id="cb42-3" data-line-number="3">kernel_w</a></code></pre></div>
<pre><code>## Reference class object of class &quot;Weight&quot;
## Field &quot;gda_w&quot;:
## An object of class &quot;_p_GeoDaWeight&quot;
## Slot &quot;ref&quot;:
## &lt;pointer: 0x7fbe733862a0&gt;
## 
## Field &quot;is_symmetric&quot;:
## [1] FALSE
## Field &quot;sparsity&quot;:
## [1] 0
## Field &quot;density&quot;:
## [1] 4.346021
## Field &quot;min_neighbors&quot;:
## [1] 1
## Field &quot;max_neighbors&quot;:
## [1] 7
## Field &quot;num_obs&quot;:
## [1] 85
## Field &quot;mean_neighbors&quot;:
## [1] 3.694118
## Field &quot;median_neighbors&quot;:
## [1] 4</code></pre>
<p>Besides the options <code>is_inverse</code>, <code>power</code>, <code>is_arc</code> and <code>is_mile</code> that are the same with the distance based weights, this kernel weights function has another option:</p>
<pre><code>use_kernel_diagonals    
(optional) FALSE (default) or TRUE, apply kernel on the diagonal of weights matrix</code></pre>
</div>
<div id="kernel-weights-with-adaptive-bandwidth" class="section level3">
<h3><span class="header-section-number">4.6.2</span> Kernel Weights with adaptive bandwidth</h3>
<p>To create a kernel weights with adaptive bandwidth or using max KNN distance as bandwidth:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1">adptkernel_w =<span class="st"> </span><span class="kw">kernel_knn_weights</span>(guerry, <span class="dv">6</span>, <span class="st">&quot;uniform&quot;</span>)</a>
<a class="sourceLine" id="cb45-2" data-line-number="2"></a>
<a class="sourceLine" id="cb45-3" data-line-number="3">adptkernel_w</a></code></pre></div>
<pre><code>## Reference class object of class &quot;Weight&quot;
## Field &quot;gda_w&quot;:
## An object of class &quot;_p_GeoDaWeight&quot;
## Slot &quot;ref&quot;:
## &lt;pointer: 0x7fbe694e6590&gt;
## 
## Field &quot;is_symmetric&quot;:
## [1] FALSE
## Field &quot;sparsity&quot;:
## [1] 0
## Field &quot;density&quot;:
## [1] 7.058824
## Field &quot;min_neighbors&quot;:
## [1] 6
## Field &quot;max_neighbors&quot;:
## [1] 6
## Field &quot;num_obs&quot;:
## [1] 85
## Field &quot;mean_neighbors&quot;:
## [1] 6
## Field &quot;median_neighbors&quot;:
## [1] 6</code></pre>
<p>This kernel weights function two more options:</p>
<pre><code>adaptive_bandwidth  
(optional) TRUE (default) or FALSE: TRUE use adaptive bandwidth calculated using distance of k-nearest neithbors, FALSE use max distance of all observation to their k-nearest neighbors

use_kernel_diagonals    
(optional) FALSE (default) or TRUE, apply kernel on the diagonal of weights matrix</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="load-spatial-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="spatial-autocorrelation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rgeoda/rgeoda-book/edit/master/03-spatialweights.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["rgeoda-book.pdf", "rgeoda-book.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
