<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8 ESDA with rgeoda and sf | rgeoda version 0.0.3</title>
  <meta name="description" content="This is a tutorial book to introduce the rgeoda v0.0.3 library. This book includes all the functions that are provided in version 0.0.3. Since rgeoda is under active development, this book will be updated frequently. Please watch this github repository to get any notifications." />
  <meta name="generator" content="bookdown 0.14 and GitBook 2.6.7" />

  <meta property="og:title" content="8 ESDA with rgeoda and sf | rgeoda version 0.0.3" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a tutorial book to introduce the rgeoda v0.0.3 library. This book includes all the functions that are provided in version 0.0.3. Since rgeoda is under active development, this book will be updated frequently. Please watch this github repository to get any notifications." />
  <meta name="github-repo" content="rgeoda/book_intro" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8 ESDA with rgeoda and sf | rgeoda version 0.0.3" />
  
  <meta name="twitter:description" content="This is a tutorial book to introduce the rgeoda v0.0.3 library. This book includes all the functions that are provided in version 0.0.3. Since rgeoda is under active development, this book will be updated frequently. Please watch this github repository to get any notifications." />
  

<meta name="author" content="Xun Li" />


<meta name="date" content="2019-10-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="esda-with-rgeoda-and-sp.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="toc.css" type="text/css" />
<link rel="stylesheet" href="fontawesome.min.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">rgeoda v0.0.3</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#live-tutorials"><i class="fa fa-check"></i><b>1.1</b> Live Tutorials</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#open-resources"><i class="fa fa-check"></i><b>1.2</b> Open Resources</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Installation</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#dependencies"><i class="fa fa-check"></i><b>2.1</b> Dependencies</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#mac"><i class="fa fa-check"></i><b>2.2</b> Mac</a></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#windows"><i class="fa fa-check"></i><b>2.3</b> Windows</a></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#linux"><i class="fa fa-check"></i><b>2.4</b> Linux</a></li>
<li class="chapter" data-level="2.5" data-path="intro.html"><a href="intro.html#load-rgeoda-library-in-r"><i class="fa fa-check"></i><b>2.5</b> Load rgeoda library in R</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="load-spatial-data.html"><a href="load-spatial-data.html"><i class="fa fa-check"></i><b>3</b> Load Spatial Data</a><ul>
<li class="chapter" data-level="3.1" data-path="load-spatial-data.html"><a href="load-spatial-data.html#attributes-of-geoda-object"><i class="fa fa-check"></i><b>3.1</b> Attributes of <code>geoda</code> object</a></li>
<li class="chapter" data-level="3.2" data-path="load-spatial-data.html"><a href="load-spatial-data.html#access-table-data"><i class="fa fa-check"></i><b>3.2</b> Access Table Data</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="spatial-weights.html"><a href="spatial-weights.html"><i class="fa fa-check"></i><b>4</b> Spatial Weights</a><ul>
<li class="chapter" data-level="4.1" data-path="spatial-weights.html"><a href="spatial-weights.html#queen-contiguity-weights"><i class="fa fa-check"></i><b>4.1</b> Queen Contiguity Weights</a></li>
<li class="chapter" data-level="4.2" data-path="spatial-weights.html"><a href="spatial-weights.html#attributes-of-weight-object"><i class="fa fa-check"></i><b>4.2</b> Attributes of <code>Weight</code> object</a></li>
<li class="chapter" data-level="4.3" data-path="spatial-weights.html"><a href="spatial-weights.html#rook-contiguity-weights"><i class="fa fa-check"></i><b>4.3</b> Rook Contiguity Weights</a></li>
<li class="chapter" data-level="4.4" data-path="spatial-weights.html"><a href="spatial-weights.html#distance-based-weights"><i class="fa fa-check"></i><b>4.4</b> Distance Based Weights</a></li>
<li class="chapter" data-level="4.5" data-path="spatial-weights.html"><a href="spatial-weights.html#k-nearest-neighbor-weights"><i class="fa fa-check"></i><b>4.5</b> K-Nearest Neighbor Weights</a></li>
<li class="chapter" data-level="4.6" data-path="spatial-weights.html"><a href="spatial-weights.html#kernel-weights"><i class="fa fa-check"></i><b>4.6</b> Kernel Weights</a><ul>
<li class="chapter" data-level="4.6.1" data-path="spatial-weights.html"><a href="spatial-weights.html#kernel-weights-with-fixed-bandwidth"><i class="fa fa-check"></i><b>4.6.1</b> Kernel Weights with fixed bandwidth</a></li>
<li class="chapter" data-level="4.6.2" data-path="spatial-weights.html"><a href="spatial-weights.html#kernel-weights-with-adaptive-bandwidth"><i class="fa fa-check"></i><b>4.6.2</b> Kernel Weights with adaptive bandwidth</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html"><i class="fa fa-check"></i><b>5</b> Spatial Autocorrelation</a><ul>
<li class="chapter" data-level="5.1" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#local-moran"><i class="fa fa-check"></i><b>5.1</b> Local Moran</a></li>
<li class="chapter" data-level="5.2" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#lisa-object"><i class="fa fa-check"></i><b>5.2</b> LISA object</a></li>
<li class="chapter" data-level="5.3" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#local-geary"><i class="fa fa-check"></i><b>5.3</b> Local Geary</a></li>
<li class="chapter" data-level="5.4" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#local-getis-ord-statistics"><i class="fa fa-check"></i><b>5.4</b> Local Getis-Ord Statistics</a></li>
<li class="chapter" data-level="5.5" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#local-join-count"><i class="fa fa-check"></i><b>5.5</b> Local Join Count</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="spatial-clustering.html"><a href="spatial-clustering.html"><i class="fa fa-check"></i><b>6</b> Spatial Clustering</a><ul>
<li class="chapter" data-level="6.1" data-path="spatial-clustering.html"><a href="spatial-clustering.html#skater"><i class="fa fa-check"></i><b>6.1</b> SKATER</a></li>
<li class="chapter" data-level="6.2" data-path="spatial-clustering.html"><a href="spatial-clustering.html#redcap"><i class="fa fa-check"></i><b>6.2</b> REDCAP</a></li>
<li class="chapter" data-level="6.3" data-path="spatial-clustering.html"><a href="spatial-clustering.html#max-p"><i class="fa fa-check"></i><b>6.3</b> Max-p</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="esda-with-rgeoda-and-sp.html"><a href="esda-with-rgeoda-and-sp.html"><i class="fa fa-check"></i><b>7</b> ESDA with rgeoda and sp</a><ul>
<li class="chapter" data-level="7.1" data-path="esda-with-rgeoda-and-sp.html"><a href="esda-with-rgeoda-and-sp.html#start-from-sp-package"><i class="fa fa-check"></i><b>7.1</b> Start from sp package</a></li>
<li class="chapter" data-level="7.2" data-path="esda-with-rgeoda-and-sp.html"><a href="esda-with-rgeoda-and-sp.html#create-geoda-object-from-sp"><i class="fa fa-check"></i><b>7.2</b> Create geoda object from sp</a></li>
<li class="chapter" data-level="7.3" data-path="esda-with-rgeoda-and-sp.html"><a href="esda-with-rgeoda-and-sp.html#esda-with-rgeoda-and-sp-1"><i class="fa fa-check"></i><b>7.3</b> ESDA with rgeoda and sp</a><ul>
<li class="chapter" data-level="7.3.1" data-path="esda-with-rgeoda-and-sp.html"><a href="esda-with-rgeoda-and-sp.html#local-moran-map"><i class="fa fa-check"></i><b>7.3.1</b> Local Moran Map</a></li>
<li class="chapter" data-level="7.3.2" data-path="esda-with-rgeoda-and-sp.html"><a href="esda-with-rgeoda-and-sp.html#local-geary-map"><i class="fa fa-check"></i><b>7.3.2</b> Local Geary Map</a></li>
<li class="chapter" data-level="7.3.3" data-path="esda-with-rgeoda-and-sp.html"><a href="esda-with-rgeoda-and-sp.html#local-g-map"><i class="fa fa-check"></i><b>7.3.3</b> Local G Map</a></li>
<li class="chapter" data-level="7.3.4" data-path="esda-with-rgeoda-and-sp.html"><a href="esda-with-rgeoda-and-sp.html#skater-map"><i class="fa fa-check"></i><b>7.3.4</b> SKATER Map</a></li>
<li class="chapter" data-level="7.3.5" data-path="esda-with-rgeoda-and-sp.html"><a href="esda-with-rgeoda-and-sp.html#max-p-clustering-map"><i class="fa fa-check"></i><b>7.3.5</b> Max-p Clustering Map</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="esda-with-rgeoda-and-sf.html"><a href="esda-with-rgeoda-and-sf.html"><i class="fa fa-check"></i><b>8</b> ESDA with rgeoda and sf</a><ul>
<li class="chapter" data-level="8.1" data-path="esda-with-rgeoda-and-sf.html"><a href="esda-with-rgeoda-and-sf.html#start-from-sf-package"><i class="fa fa-check"></i><b>8.1</b> Start from sf package</a></li>
<li class="chapter" data-level="8.2" data-path="esda-with-rgeoda-and-sf.html"><a href="esda-with-rgeoda-and-sf.html#create-geoda-object-from-sf"><i class="fa fa-check"></i><b>8.2</b> Create geoda object from sf</a></li>
<li class="chapter" data-level="8.3" data-path="esda-with-rgeoda-and-sf.html"><a href="esda-with-rgeoda-and-sf.html#esda-with-rgeoda-and-sf-1"><i class="fa fa-check"></i><b>8.3</b> ESDA with rgeoda and sf</a><ul>
<li class="chapter" data-level="8.3.1" data-path="esda-with-rgeoda-and-sf.html"><a href="esda-with-rgeoda-and-sf.html#local-moran-map-1"><i class="fa fa-check"></i><b>8.3.1</b> Local Moran Map</a></li>
<li class="chapter" data-level="8.3.2" data-path="esda-with-rgeoda-and-sf.html"><a href="esda-with-rgeoda-and-sf.html#local-geary-map-1"><i class="fa fa-check"></i><b>8.3.2</b> Local Geary Map</a></li>
<li class="chapter" data-level="8.3.3" data-path="esda-with-rgeoda-and-sf.html"><a href="esda-with-rgeoda-and-sf.html#local-g-map-1"><i class="fa fa-check"></i><b>8.3.3</b> Local G Map</a></li>
<li class="chapter" data-level="8.3.4" data-path="esda-with-rgeoda-and-sf.html"><a href="esda-with-rgeoda-and-sf.html#skater-map-1"><i class="fa fa-check"></i><b>8.3.4</b> SKATER Map</a></li>
<li class="chapter" data-level="8.3.5" data-path="esda-with-rgeoda-and-sf.html"><a href="esda-with-rgeoda-and-sf.html#max-p-clustering-map-1"><i class="fa fa-check"></i><b>8.3.5</b> Max-p Clustering Map</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rgeoda/rgeoda-book" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">rgeoda version 0.0.3</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="esda-with-rgeoda-and-sf" class="section level1">
<h1><span class="header-section-number">8</span> ESDA with rgeoda and sf</h1>
<p>Another modern and popular routine for spatial data analysis with R is to use <a href="https://github.com/r-spatial/sf">sf</a> library to process geospatial dataset, analyze spatial data and plot the results on maps.</p>
<p>rgeoda provides utility functions to create a <code>geoda</code> instance from an <code>sf</code> object, so that users can easily integrate the functions of spatial data analysis in rgeoda into their existing work.</p>
<p>In this note, we will work with <code>sf</code> and <code>rgeoda</code> libraries to do exploratory spatial data analysis (ESDA).</p>
<div id="start-from-sf-package" class="section level2">
<h2><span class="header-section-number">8.1</span> Start from sf package</h2>
<p>The sf package has been popular tool to handle geospatial data. It is a good substitue of sp package which will be deprecated soon.</p>
<p>For example, to load a geospatial data (e.g. a ESRI Shapefile) using sf:</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" data-line-number="1"><span class="co"># use the Guerry.shp comes with the rgeoda package</span></a>
<a class="sourceLine" id="cb128-2" data-line-number="2">guerry_path &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;Guerry.shp&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;rgeoda&quot;</span>)</a>
<a class="sourceLine" id="cb128-3" data-line-number="3"></a>
<a class="sourceLine" id="cb128-4" data-line-number="4"><span class="co"># load sf library</span></a>
<a class="sourceLine" id="cb128-5" data-line-number="5"><span class="kw">library</span>(sf)</a></code></pre></div>
<pre><code>## Linking to GEOS 3.7.2, GDAL 2.4.1, PROJ 6.1.0</code></pre>
<div class="rmdinfo">
<p>
Note: to install sf library in R, you can run: <code>install.packages(‘sf’)</code>
</p>
</div>
<p>Then, we can call <code>st_read()</code> function to read Guerry.shp file and this function will returns an <code>sf</code> object</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" data-line-number="1">guerry_sf &lt;-<span class="st"> </span><span class="kw">st_read</span>(guerry_path)</a></code></pre></div>
<pre><code>## Reading layer `Guerry&#39; from data source `/usr/local/lib/R/3.6/site-library/rgeoda/extdata/Guerry.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 85 features and 26 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: 47680 ymin: 1703258 xmax: 1031401 ymax: 2677441
## epsg (SRID):    27572
## proj4string:    +proj=lcc +lat_1=46.8 +lat_0=46.8 +lon_0=0 +k_0=0.99987742 +x_0=600000 +y_0=2200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs</code></pre>
<p>You can simply call plot() function to render the first 9 chorepleth maps using the frist 9 variables in the dataset:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" data-line-number="1"><span class="kw">plot</span>(guerry_sf)</a></code></pre></div>
<pre><code>## Warning: plotting the first 9 out of 26 attributes; use max.plot = 26 to
## plot all</code></pre>
<p><img src="rgeoda-book_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
</div>
<div id="create-geoda-object-from-sf" class="section level2">
<h2><span class="header-section-number">8.2</span> Create geoda object from sf</h2>
<p>sf package makes it easy to work with geospatial data. It also provides functions to do basic spatial data analysis. rgeoda provides helper function sf_to_geoda to create a geoda object from a sf object. Users can then call rgeoda functions to do further spatial data analysis.</p>
<p>Create a geoda object from the sf object guerry_sp you just created.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" data-line-number="1"><span class="co"># load rgeoda library</span></a>
<a class="sourceLine" id="cb134-2" data-line-number="2"><span class="kw">library</span>(rgeoda)</a>
<a class="sourceLine" id="cb134-3" data-line-number="3"></a>
<a class="sourceLine" id="cb134-4" data-line-number="4"><span class="co"># call function to create a geoda object from sf object</span></a>
<a class="sourceLine" id="cb134-5" data-line-number="5">guerry &lt;-<span class="st"> </span><span class="kw">sf_to_geoda</span>(guerry_sf)</a></code></pre></div>
<div class="rmdinfo">
<ol style="list-style-type: decimal">
<li>
rgeoda uses wkb, which is a binary representation of geometries, to exchange data between sf and libgeoda in memory.
</li>
</ol>
</div>
<div class="rmdinfo">
<ol start="2" style="list-style-type: decimal">
<li>
By default, sf_to_geoda() only using geometries to create a geoda object, which is fast and user can reuse the data.frame from the sf object to do analysis. This function has an optional parameter <code>with_table</code>, to allow user to use both geometries and data.frame to create a geoda object by calling, for example: sp_to_geoda(guerry_sp, with_table=TRUE)
</li>
</ol>
</div>
</div>
<div id="esda-with-rgeoda-and-sf-1" class="section level2">
<h2><span class="header-section-number">8.3</span> ESDA with rgeoda and sf</h2>
<p>Now, with the geoda object <code>guerry</code>, you can call rgeoda’s spatial analysis functions. For example, to examine the local Moran statistics of variable “crm_prp” (Population per Crime against persons):</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" data-line-number="1">queen_w &lt;-<span class="st"> </span><span class="kw">queen_weights</span>(guerry)</a>
<a class="sourceLine" id="cb135-2" data-line-number="2">crm_prp &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(guerry_sf<span class="op">$</span>Crm_prp)</a>
<a class="sourceLine" id="cb135-3" data-line-number="3">queen_w</a></code></pre></div>
<pre><code>## Reference class object of class &quot;Weight&quot;
## Field &quot;gda_w&quot;:
## An object of class &quot;_p_GeoDaWeight&quot;
## Slot &quot;ref&quot;:
## &lt;pointer: 0x7f99377273a0&gt;
## 
## Field &quot;is_symmetric&quot;:
## [1] TRUE
## Field &quot;sparsity&quot;:
## [1] 0
## Field &quot;density&quot;:
## [1] 5.813149
## Field &quot;min_neighbors&quot;:
## [1] 2
## Field &quot;max_neighbors&quot;:
## [1] 8
## Field &quot;num_obs&quot;:
## [1] 85
## Field &quot;mean_neighbors&quot;:
## [1] 4.941176
## Field &quot;median_neighbors&quot;:
## [1] 5</code></pre>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" data-line-number="1">crm_prp</a></code></pre></div>
<pre><code>##  [1] 15890  5521  7925  7289  8174 10263  8847  9597  4086 10431  6731
## [12]  5291  4500 11645 13018  5357 10503 12949  9159  7050 20235 10237
## [23]  5914  7759  4774  4016  6842  7990  7204 10486  7423 10954  6524
## [34]  7624  6909  8326  8059  6170  6017 12665 18043  9392  5042  9049
## [45]  8943  5990  8520  7424  4950  9539  9198  6831  9190  7940  4529
## [56]  8236  6175  6659  8248  4040 12141  8533  9797  7632  4920  4915
## [67]  4504  7770 10708  8294  1368  2906  5786  3879  6863  7144  6241
## [78]  8680  9572  5731  7566  4710  6402  9044  6516</code></pre>
<div id="local-moran-map-1" class="section level3">
<h3><span class="header-section-number">8.3.1</span> Local Moran Map</h3>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" data-line-number="1">lisa &lt;-<span class="st"> </span><span class="kw">local_moran</span>(queen_w, crm_prp)</a></code></pre></div>
<p>Now, with the LISA results, we can do exploratory spatial data analysis by generating a LISA cluster map:</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" data-line-number="1">lisa_colors &lt;-<span class="st"> </span>lisa<span class="op">$</span><span class="kw">GetColors</span>() </a>
<a class="sourceLine" id="cb140-2" data-line-number="2">lisa_labels &lt;-<span class="st"> </span>lisa<span class="op">$</span><span class="kw">GetLabels</span>()</a>
<a class="sourceLine" id="cb140-3" data-line-number="3">lisa_clusters &lt;-<span class="st"> </span>lisa<span class="op">$</span><span class="kw">GetClusterIndicators</span>()</a>
<a class="sourceLine" id="cb140-4" data-line-number="4"></a>
<a class="sourceLine" id="cb140-5" data-line-number="5"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(guerry_sf), </a>
<a class="sourceLine" id="cb140-6" data-line-number="6">     <span class="dt">col=</span><span class="kw">sapply</span>(lisa_clusters, <span class="cf">function</span>(x){<span class="kw">return</span>(lisa_colors[[x<span class="op">+</span><span class="dv">1</span>]])}), </a>
<a class="sourceLine" id="cb140-7" data-line-number="7">     <span class="dt">border =</span> <span class="st">&quot;#333333&quot;</span>, <span class="dt">lwd=</span><span class="fl">0.2</span>)</a>
<a class="sourceLine" id="cb140-8" data-line-number="8"><span class="kw">title</span>(<span class="dt">main =</span> <span class="st">&quot;Local Moran Map of Crm_prp&quot;</span>)</a>
<a class="sourceLine" id="cb140-9" data-line-number="9"><span class="kw">legend</span>(<span class="st">&#39;bottomleft&#39;</span>, <span class="dt">legend =</span> lisa_labels, <span class="dt">fill =</span> lisa_colors, <span class="dt">border =</span> <span class="st">&quot;#eeeeee&quot;</span>)</a></code></pre></div>
<p><img src="rgeoda-book_files/figure-html/unnamed-chunk-80-1.png" width="672" /></p>
<p>From the above code, you can see that we still use <code>sp</code> object to do plotting. The values of cluster indicators from rgeoda’s <code>LISA</code> object are used to make the LISA map.This emphasis that rgeoda is a API focused library, which only provides the core functions of spatial data analysis for easy integration.</p>
<p>You can easily append the lisa results to original sp object by manipulating the data.frame object inside the sp object.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" data-line-number="1">guerry_sf<span class="op">$</span>moran_cluster &lt;-<span class="st"> </span>lisa_clusters</a></code></pre></div>
<p>If you check the values of the cluster indicators, you will see they are integer numbers 0 (not significant), 1 (high-high cluster), 2 (low-low cluster), 3 (low-high cluster), 4 (high-low cluster), 5 (neighborless/island), 6 (undefined), which are excatly the same with GeoDa software when you save LISA results to a table:</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" data-line-number="1">lisa_clusters</a></code></pre></div>
<pre><code>##  [1] 0 0 1 0 0 0 0 0 0 0 0 0 0 1 0 0 0 1 0 0 1 0 0 0 2 2 0 0 0 0 0 0 0 0 0
## [36] 1 0 0 0 1 1 0 0 0 0 3 0 0 0 0 0 0 0 0 0 0 2 2 0 0 1 0 0 0 0 0 3 0 0 0
## [71] 2 0 2 2 0 2 0 0 0 0 0 0 3 0 0</code></pre>
<p>To create a siginificant map that is associated with the Local Moran map:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" data-line-number="1">lisa_p &lt;-<span class="st"> </span>lisa<span class="op">$</span><span class="kw">GetPValues</span>()</a>
<a class="sourceLine" id="cb144-2" data-line-number="2">p_labels &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Not significant&quot;</span>, <span class="st">&quot;p &lt;= 0.05&quot;</span>, <span class="st">&quot;p &lt;= 0.01&quot;</span>, <span class="st">&quot;p &lt;= 0.001&quot;</span>)</a>
<a class="sourceLine" id="cb144-3" data-line-number="3">p_colors &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;#eeeeee&quot;</span>, <span class="st">&quot;#84f576&quot;</span>, <span class="st">&quot;#53c53c&quot;</span>, <span class="st">&quot;#348124&quot;</span>)</a>
<a class="sourceLine" id="cb144-4" data-line-number="4"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(guerry_sf), </a>
<a class="sourceLine" id="cb144-5" data-line-number="5">     <span class="dt">col=</span><span class="kw">sapply</span>(lisa_p, <span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb144-6" data-line-number="6">       <span class="cf">if</span> (x <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.001</span>) <span class="kw">return</span>(p_colors[<span class="dv">4</span>])</a>
<a class="sourceLine" id="cb144-7" data-line-number="7">       <span class="cf">else</span> <span class="cf">if</span> (x <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.01</span>) <span class="kw">return</span>(p_colors[<span class="dv">3</span>])</a>
<a class="sourceLine" id="cb144-8" data-line-number="8">       <span class="cf">else</span> <span class="cf">if</span> (x <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span>) <span class="kw">return</span> (p_colors[<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb144-9" data-line-number="9">       <span class="cf">else</span> <span class="kw">return</span>(p_colors[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb144-10" data-line-number="10">       }), </a>
<a class="sourceLine" id="cb144-11" data-line-number="11">     <span class="dt">border =</span> <span class="st">&quot;#333333&quot;</span>, <span class="dt">lwd=</span><span class="fl">0.2</span>)</a>
<a class="sourceLine" id="cb144-12" data-line-number="12"><span class="kw">title</span>(<span class="dt">main =</span> <span class="st">&quot;Local Moran Map of Crm_prp&quot;</span>)</a>
<a class="sourceLine" id="cb144-13" data-line-number="13"><span class="kw">legend</span>(<span class="st">&#39;bottomleft&#39;</span>, <span class="dt">legend =</span> p_labels, <span class="dt">fill =</span> p_colors, <span class="dt">border =</span> <span class="st">&quot;#eeeeee&quot;</span>)</a></code></pre></div>
<p><img src="rgeoda-book_files/figure-html/unnamed-chunk-83-1.png" width="672" /></p>
</div>
<div id="local-geary-map-1" class="section level3">
<h3><span class="header-section-number">8.3.2</span> Local Geary Map</h3>
<p>Another example is to create a map of local Geary:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" data-line-number="1">lisa &lt;-<span class="st"> </span><span class="kw">local_geary</span>(queen_w, crm_prp)</a>
<a class="sourceLine" id="cb145-2" data-line-number="2">lisa_colors &lt;-<span class="st"> </span>lisa<span class="op">$</span><span class="kw">GetColors</span>() </a>
<a class="sourceLine" id="cb145-3" data-line-number="3">lisa_labels &lt;-<span class="st"> </span>lisa<span class="op">$</span><span class="kw">GetLabels</span>()</a>
<a class="sourceLine" id="cb145-4" data-line-number="4">lisa_clusters &lt;-<span class="st"> </span>lisa<span class="op">$</span><span class="kw">GetClusterIndicators</span>()</a>
<a class="sourceLine" id="cb145-5" data-line-number="5"></a>
<a class="sourceLine" id="cb145-6" data-line-number="6"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(guerry_sf), </a>
<a class="sourceLine" id="cb145-7" data-line-number="7">     <span class="dt">col=</span><span class="kw">sapply</span>(lisa_clusters, <span class="cf">function</span>(x){<span class="kw">return</span>(lisa_colors[[x<span class="op">+</span><span class="dv">1</span>]])}), </a>
<a class="sourceLine" id="cb145-8" data-line-number="8">     <span class="dt">border =</span> <span class="st">&quot;#333333&quot;</span>, <span class="dt">lwd=</span><span class="fl">0.2</span>)</a>
<a class="sourceLine" id="cb145-9" data-line-number="9"><span class="kw">title</span>(<span class="dt">main =</span> <span class="st">&quot;Local Geary Map of Crm_prp&quot;</span>)</a>
<a class="sourceLine" id="cb145-10" data-line-number="10"><span class="kw">legend</span>(<span class="st">&#39;bottomleft&#39;</span>, <span class="dt">legend =</span> lisa_labels, <span class="dt">fill =</span> lisa_colors, <span class="dt">border =</span> <span class="st">&quot;#eeeeee&quot;</span>)</a></code></pre></div>
<p><img src="rgeoda-book_files/figure-html/unnamed-chunk-84-1.png" width="672" /></p>
</div>
<div id="local-g-map-1" class="section level3">
<h3><span class="header-section-number">8.3.3</span> Local G Map</h3>
<p>To create a map of local G:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" data-line-number="1">lisa &lt;-<span class="st"> </span><span class="kw">local_g</span>(queen_w, crm_prp)</a>
<a class="sourceLine" id="cb146-2" data-line-number="2">lisa_colors &lt;-<span class="st"> </span>lisa<span class="op">$</span><span class="kw">GetColors</span>() </a>
<a class="sourceLine" id="cb146-3" data-line-number="3">lisa_labels &lt;-<span class="st"> </span>lisa<span class="op">$</span><span class="kw">GetLabels</span>()</a>
<a class="sourceLine" id="cb146-4" data-line-number="4">lisa_clusters &lt;-<span class="st"> </span>lisa<span class="op">$</span><span class="kw">GetClusterIndicators</span>()</a>
<a class="sourceLine" id="cb146-5" data-line-number="5"></a>
<a class="sourceLine" id="cb146-6" data-line-number="6"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(guerry_sf), </a>
<a class="sourceLine" id="cb146-7" data-line-number="7">     <span class="dt">col=</span><span class="kw">sapply</span>(lisa_clusters, <span class="cf">function</span>(x){<span class="kw">return</span>(lisa_colors[[x<span class="op">+</span><span class="dv">1</span>]])}), </a>
<a class="sourceLine" id="cb146-8" data-line-number="8">     <span class="dt">border =</span> <span class="st">&quot;#333333&quot;</span>, <span class="dt">lwd=</span><span class="fl">0.2</span>)</a>
<a class="sourceLine" id="cb146-9" data-line-number="9"><span class="kw">title</span>(<span class="dt">main =</span> <span class="st">&quot;Local Getis-Ord&#39;s G Map of Crm_prp&quot;</span>)</a>
<a class="sourceLine" id="cb146-10" data-line-number="10"><span class="kw">legend</span>(<span class="st">&#39;bottomleft&#39;</span>, <span class="dt">legend =</span> lisa_labels, <span class="dt">fill =</span> lisa_colors, <span class="dt">border =</span> <span class="st">&quot;#eeeeee&quot;</span>)</a></code></pre></div>
<p><img src="rgeoda-book_files/figure-html/unnamed-chunk-85-1.png" width="672" /></p>
</div>
<div id="skater-map-1" class="section level3">
<h3><span class="header-section-number">8.3.4</span> SKATER Map</h3>
<p>To create a map of SKATER clustering map:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb147-1" data-line-number="1">Crm_prs &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(guerry_sf<span class="op">$</span>Crm_prs)</a>
<a class="sourceLine" id="cb147-2" data-line-number="2">Litercy &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(guerry_sf<span class="op">$</span>Litercy)</a>
<a class="sourceLine" id="cb147-3" data-line-number="3">Donatns &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(guerry_sf<span class="op">$</span>Donatns)</a>
<a class="sourceLine" id="cb147-4" data-line-number="4">Infants &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(guerry_sf<span class="op">$</span>Infants)</a>
<a class="sourceLine" id="cb147-5" data-line-number="5">Suicids &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(guerry_sf<span class="op">$</span>Suicids)</a>
<a class="sourceLine" id="cb147-6" data-line-number="6">data &lt;-<span class="st"> </span><span class="kw">list</span>(Crm_prs, crm_prp, Litercy, Donatns, Infants, Suicids)</a>
<a class="sourceLine" id="cb147-7" data-line-number="7">guerry_clusters &lt;-<span class="st"> </span><span class="kw">skater</span>(<span class="dv">4</span>, queen_w, data)</a>
<a class="sourceLine" id="cb147-8" data-line-number="8"></a>
<a class="sourceLine" id="cb147-9" data-line-number="9"><span class="co"># Get some colors for each clusters</span></a>
<a class="sourceLine" id="cb147-10" data-line-number="10">skater_colors &lt;-<span class="st"> </span><span class="kw">palette</span>()[<span class="dv">2</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb147-11" data-line-number="11">skater_labels &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;c1&quot;</span>,<span class="st">&quot;c2&quot;</span>,<span class="st">&quot;c3&quot;</span>,<span class="st">&quot;c4&quot;</span>)</a>
<a class="sourceLine" id="cb147-12" data-line-number="12"></a>
<a class="sourceLine" id="cb147-13" data-line-number="13"><span class="co"># Assign a color for each observation</span></a>
<a class="sourceLine" id="cb147-14" data-line-number="14">colors &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;#000000&quot;</span>, queen_w<span class="op">$</span>num_obs)</a>
<a class="sourceLine" id="cb147-15" data-line-number="15"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) {</a>
<a class="sourceLine" id="cb147-16" data-line-number="16">  <span class="cf">for</span> (j <span class="cf">in</span> guerry_clusters[i]) {</a>
<a class="sourceLine" id="cb147-17" data-line-number="17">    colors[j<span class="op">+</span><span class="dv">1</span>] &lt;-<span class="st"> </span>skater_colors[i]</a>
<a class="sourceLine" id="cb147-18" data-line-number="18">  }</a>
<a class="sourceLine" id="cb147-19" data-line-number="19">}</a>
<a class="sourceLine" id="cb147-20" data-line-number="20"></a>
<a class="sourceLine" id="cb147-21" data-line-number="21"><span class="co"># plot</span></a>
<a class="sourceLine" id="cb147-22" data-line-number="22"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(guerry_sf),  <span class="dt">col=</span>colors, <span class="dt">border =</span> <span class="st">&quot;#333333&quot;</span>, <span class="dt">lwd=</span><span class="fl">0.2</span>)</a>
<a class="sourceLine" id="cb147-23" data-line-number="23"><span class="kw">title</span>(<span class="dt">main =</span> <span class="st">&quot;SKATER Clustering Map&quot;</span>)</a>
<a class="sourceLine" id="cb147-24" data-line-number="24"><span class="kw">legend</span>(<span class="st">&#39;bottomleft&#39;</span>, <span class="dt">legend =</span> skater_labels, <span class="dt">fill =</span> skater_colors, <span class="dt">border =</span> <span class="st">&quot;#eeeeee&quot;</span>)</a></code></pre></div>
<p><img src="rgeoda-book_files/figure-html/unnamed-chunk-86-1.png" width="672" /></p>
</div>
<div id="max-p-clustering-map-1" class="section level3">
<h3><span class="header-section-number">8.3.5</span> Max-p Clustering Map</h3>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb148-1" data-line-number="1">bound_vals &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(guerry_sf<span class="op">$</span>Pop1831)</a>
<a class="sourceLine" id="cb148-2" data-line-number="2">min_bound &lt;-<span class="st"> </span><span class="fl">3236.67</span> <span class="co"># 10% of Pop1831</span></a>
<a class="sourceLine" id="cb148-3" data-line-number="3"></a>
<a class="sourceLine" id="cb148-4" data-line-number="4">maxp_clusters &lt;-<span class="st"> </span><span class="kw">maxp</span>(queen_w, data, bound_vals, min_bound, <span class="st">&quot;greedy&quot;</span>)</a>
<a class="sourceLine" id="cb148-5" data-line-number="5"></a>
<a class="sourceLine" id="cb148-6" data-line-number="6"><span class="co"># Get some colors for each clusters</span></a>
<a class="sourceLine" id="cb148-7" data-line-number="7">maxp_colors &lt;-<span class="st"> </span><span class="kw">palette</span>()[<span class="dv">2</span><span class="op">:</span><span class="dv">10</span>]</a>
<a class="sourceLine" id="cb148-8" data-line-number="8">maxp_labels &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;c1&quot;</span>,<span class="st">&quot;c2&quot;</span>,<span class="st">&quot;c3&quot;</span>,<span class="st">&quot;c4&quot;</span>,<span class="st">&quot;c5&quot;</span>,<span class="st">&quot;c6&quot;</span>,<span class="st">&quot;c7&quot;</span>,<span class="st">&quot;c8&quot;</span>)</a>
<a class="sourceLine" id="cb148-9" data-line-number="9"></a>
<a class="sourceLine" id="cb148-10" data-line-number="10"><span class="co"># Assign a color for each observation</span></a>
<a class="sourceLine" id="cb148-11" data-line-number="11">colors &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;#000000&quot;</span>, queen_w<span class="op">$</span>num_obs)</a>
<a class="sourceLine" id="cb148-12" data-line-number="12"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">8</span>) {</a>
<a class="sourceLine" id="cb148-13" data-line-number="13">  <span class="cf">for</span> (j <span class="cf">in</span> maxp_clusters[i]) {</a>
<a class="sourceLine" id="cb148-14" data-line-number="14">    colors[j<span class="op">+</span><span class="dv">1</span>] &lt;-<span class="st"> </span>maxp_colors[i]</a>
<a class="sourceLine" id="cb148-15" data-line-number="15">  }</a>
<a class="sourceLine" id="cb148-16" data-line-number="16">}</a>
<a class="sourceLine" id="cb148-17" data-line-number="17"></a>
<a class="sourceLine" id="cb148-18" data-line-number="18"><span class="co"># plot</span></a>
<a class="sourceLine" id="cb148-19" data-line-number="19"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(guerry_sf),  <span class="dt">col=</span>colors, <span class="dt">border =</span> <span class="st">&quot;#333333&quot;</span>, <span class="dt">lwd=</span><span class="fl">0.2</span>)</a>
<a class="sourceLine" id="cb148-20" data-line-number="20"><span class="kw">title</span>(<span class="dt">main =</span> <span class="st">&quot;Max-p Clustering Map&quot;</span>)</a>
<a class="sourceLine" id="cb148-21" data-line-number="21"><span class="kw">legend</span>(<span class="st">&#39;bottomleft&#39;</span>, <span class="dt">legend =</span> maxp_labels, <span class="dt">fill =</span> maxp_colors, <span class="dt">border =</span> <span class="st">&quot;#eeeeee&quot;</span>)</a></code></pre></div>
<p><img src="rgeoda-book_files/figure-html/unnamed-chunk-87-1.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="esda-with-rgeoda-and-sp.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rgeoda/rgeoda-book/edit/master/07-esda_sf.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["rgeoda-book.pdf", "rgeoda-book.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
